{% extends "base_teacher.html" %}
{% block title %}Weekly Defaulters{% endblock %}
{% block breadcrumb %}
<div class="breadcrumb"><a href="{{ url_for('dashboard') }}">Dashboard</a> â†’ Weekly Defaulters (Below 75%)</div>
{% endblock %}
{% block content %}
<div class="card">
    <h2>Weekly Defaulters</h2>
    <p style="margin-bottom: 20px; font-size: 14px; color: #64748b;">Students with less than 75% attendance in the last 7 days.</p>
    <form method="POST" class="form-row" style="align-items: flex-end;">
        <div class="form-group" style="min-width: 150px;">
            <label>Standard</label>
            <select name="standard" required>
                <option value="">Select</option>
                {% for i in range(1, 13) %}
                <option value="{{ i }}" {% if standard == i|string %}selected{% endif %}>Class {{ i }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" style="min-width: 120px;">
            <label>Division</label>
            <select name="division" required>
                <option value="">Select</option>
                {% for d in ['A','B','C','D'] %}
                <option value="{{ d }}" {% if division == d %}selected{% endif %}>{{ d }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <button type="submit" class="btn">Show Defaulters</button>
        </div>
    </form>
    {% if defaulters is not none %}
    {% if defaulters %}
    <table style="margin-top: 20px;">
        <thead><tr><th>Roll</th><th>Name</th><th>Attendance %</th></tr></thead>
        <tbody>
        {% for d in defaulters %}
        <tr>
            <td>{{ d.roll }}</td>
            <td>{{ d.name }}</td>
            <td><span style="color: var(--danger); font-weight: 600;">{{ d.percentage }}%</span></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <form method="POST" action="{{ url_for('export_weekly_defaulters') }}" style="margin-top: 20px;">
        <input type="hidden" name="standard" value="{{ standard }}">
        <input type="hidden" name="division" value="{{ division }}">
        <button type="submit" class="btn btn-secondary">Export to Excel</button>
    </form>
    {% else %}
    <p style="margin-top: 25px; padding: 20px; background: #dcfce7; border-radius: 8px; color: var(--success);">No defaulters ðŸŽ‰ All students have 75% or above attendance.</p>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
